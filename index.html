<script>
  async function loadData() {
    const res = await fetch("https://docs.google.com/spreadsheets/d/1ZISfkRoQPYzlPkIXkWdyNtueJTRq3_edQtQQuPDDasw/gviz/tq?tqx=out:json");
    const text = await res.text();
    const json = JSON.parse(text.substr(47).slice(0, -2));

    const rows = json.table.rows;
    let html = "";

    // начинаем с i=1 чтобы пропустить заголовки
    for (let i = 1; i < rows.length; i++) {
      const r = rows[i].c;
      if (!r[4]) continue; // если нет кандидата - пропускаем пустую строку

      const date = r[0]?.v || "";
      const agency = r[1]?.v || "";
      const recruiter = r[2]?.v || "";
      const vacancy = r[3]?.v || "";
      const candidate = r[4]?.v || "";
      const email = r[5]?.v || "";
      const position = r[6]?.v || "";
      const salary = r[7]?.v || "";
      const location = r[8]?.v || "";
      const linkedin = r[9]?.v || "";
      const cv = r[10]?.v || "";
      const status = r[11]?.v || "";
      const comment = r[12]?.v || "";

      html += `
        <div class="card">
          <h3>${candidate} (${position})</h3>
          <p><b>Агентство:</b> ${agency}</p>
          <p><b>Рекрутер:</b> ${recruiter}</p>
          <p><b>Вакансия:</b> ${vacancy}</p>
          <p><b>Дата:</b> ${date}</p>
          <p><b>Зарплата:</b> ${salary}</p>
          <p><b>Локация:</b> ${location}</p>
          <p><b>Email:</b> <a href="mailto:${email}">${email}</a></p>
          <p><a href="${linkedin}" target="_blank">LinkedIn</a> | <a href="${cv}" target="_blank">CV</a></p>
          <p><b>Статус:</b> ${status}</p>
          <p><b>Комментарий:</b> ${comment}</p>
        </div>
      `;
    }

    document.getElementById("content").innerHTML = html;
  }

  loadData();
</script>
